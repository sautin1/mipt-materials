# Машина фон Неймана
## Язык псевдоассемблера
### Общие правила
#### Функции и метки. Блоки
* Каждая программа должна содержать функцию _.main_.
* С функции _.main_ начинается исполнение программы.
* Метки и функции условно разбивают программу на блоки.
* После блока функции _.main_ не должно идти никакого кода. Если есть необходимость в написании кода после функции _.main_, то В конце блока функции _.main_ должна явно вызываться команда выхода из программы.
* Блоки меток могут содержаться внутри блоков функций. Обратное возможно, но нежелательно.
* Блок желательно выделять отступом в 4 пробела.

#### Команды и унарные предикаты
* Все команды и унарные предикаты пишутся большими буквами.

#### Переменные
* Все переменные -- числовые.

#### Комментарии
* Строки, начинающиеся с символа '#', являются комментариями и полностью игнорируются компилятором.

### Список команд

| Команда                                               | Действие                                                                                                                                                                                                                                                                                     | Примечания                                                                                                                          |
|-------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------|
| GLOB {name}                                           | Определяет глобальную переменную с именем name.                                                                                                                                                                                                                                              | Все глобальные переменные должны объявляться в начале программы.                                                                    |
| VAR {name}                                            | Определяет локальную переменную с именем name.                                                                                                                                                                                                                                               | Все локальные переменные должны объявляться в начале блока функции.                                                                 |
| PRINT {name/number/string}                            | Печатает в консоль значение переменной _name_, числовой литерал _number_ или строковый литерал _string_. Курсор **не переносится** на новую строку.                                                                                                                                          | Строковые литералы должны заключаться в двойную пару кавычек разного типа: `'"hello"'` или `"'hello'"`.                             |
| PRINTLN {name/number/string}                          | Печатает в консоль значение переменной _name_, числовой литерал _number_ или строковый литерал _string_. Курсор **переносится** на новую строку.                                                                                                                                             | Строковые литералы должны заключаться в двойную пару кавычек разного типа: `'"hello"'` или `"'hello'"`.                             |
| READ -> {var}                                         | Считывает с консоли числовое значение и сохраняет его в переменную _var_.                                                                                                                                                                                                                    | -                                                                                                                                   |
| MOVE {varTarget} {varSource/number}                   | Копирует значение переменной _varSource_ или числовой литерал _number_ в переменную _varTarget_.                                                                                                                                                                                             | -                                                                                                                                   |
| ADD {argX} {argY} -> {varResult}                      | Складывает аргументы _argX_ и _argY_ и сохраняет результат в переменную _varResult_. _argX_ и _argY_ могут быть либо переменными, либо числовыми литералами.                                                                                                                                 | -                                                                                                                                   |
| SUB {argX} {argY} -> {varResult}                      | Вычитает аргументы _argX_ и _argY_ и сохраняет результат в переменную _varResult_. _argX_ и _argY_ могут быть либо переменными, либо числовыми литералами.                                                                                                                                   | -                                                                                                                                   |
| MUL {argX} {argY} -> {varResult}                      | Перемножает аргументы _argX_ и _argY_ и сохраняет результат в переменную _varResult_. _argX_ и _argY_ могут быть либо переменными, либо числовыми литералами.                                                                                                                                | -                                                                                                                                   |
| DIV {argX} {argY} -> {varResult}                      | Делит (целочисленно) аргумент _argX_ на _argY_ и сохраняет частное в переменную _varResult_. _argX_ и _argY_ могут быть либо переменными, либо числовыми литералами.                                                                                                                         | -                                                                                                                                   |
| MOD {argX} {argY} -> {varResult}                      | Делит (целочисленно) аргумент _argX_ на _argY_ и сохраняет остаток в переменную _varResult_. _argX_ и _argY_ могут быть либо переменными, либо числовыми литералами.                                                                                                                         | -                                                                                                                                   |
| LABEL {name}                                          | Определяет метку с именем _name_.                                                                                                                                                                                                                                                            | Названия меток желательно начинать с точки и составлять из маленьких букв.                                                          |
| JUMP {name}                                           | Выполняет безусловный переход по метке _name_.                                                                                                                                                                                                                                               | -                                                                                                                                   |
| IF {predicate} {var/number} {labelThen} [{labelElse}] | Если унарный предикат _predicate_ истинен на переменной _var_ или числовом литерале _number_, то выполняется переход по метке _labelThen_. Иначе, выполняется переход по _labelElse_. Если предикат оказался ложен, а _labelElse_ не указана, то программа переходит к следующей инструкции. | Возможные унарные предикаты перечислены в [следующем разделе](#Список-унарных-предикатов).                                          |
| FUN {name} [{arg1} [{arg2} [...]]]                    | Определяет функцию с именем _name_ и аргументами с именами _arg1_, _arg2_ и т.д.                                                                                                                                                                                                             | Названия функций желательно начинать с точки и составлять из маленьких букв. Функция без аргументов является частным случаем метки. |
| CALL {name} [{arg1} [{arg2} [...]]] -> {varResult}    | Вызывает функцию _name_, передавая в качестве аргументов _arg1_, _arg2_ и т.д. Результат вызова функции сохраняется в переменную _varResult_. Аргументы _arg1_, _arg2_, ... могут быть либо переменными, либо числовыми литералами.                                                          | -                                                                                                                                   |
| RET {var/number}                                      | Выполняет выход из функции, возвращая значение переменной _var_ или числовой литерал _number_.                                                                                                                                                                                               | -                                                                                                                                   |
| EXIT                                                  | Выполняет аварийный выход из программы.                                                                                                                                                                                                                                                      | Использование нежелательно.                                                                                                         |

### Список унарных предикатов

| Унарный предикат | Описание                |
|------------------|-------------------------|
| EQ0              | Равно нулю?             |
| G0               | Больше нуля?            |
| L0               | Меньше нуля?            |
| GE0              | Больше либо равно нулю? |
| LE0              | Меньше либо равно нулю? |
| NEQ0             | Не равно нулю?          |

## Bytecode

Инструкция -- 6 байт.
Пример: 12 34 56 78 9A BC
12 -- номер команды
34 -- флаг команды
если флаг равен 0, значит берется значение
1 -- берется адрес
2 -- берется адрес, лежащий по адресу
56 78 9A BC -- значение (4 байта ~ int) или адрес

Инструкции:
mov addr1 addr2

Устройство образа программы:
1. ip
2. sp
3. arithmetic result
4. glob_1
...
n+3. glob_n

n+4. instr_1
...
n+m+3. instr_m

n+m+4. stack_1
...
n+m+k+3. stack_k

GLOB name
VAR name
FUN name arg1 ... argN
LABEL name
IF operator varName labelNameTrue [labelNameFalse]

ADD varName1 varName2 -> resultVarName
ADD varName1 number -> resultVarName
SUB varName1 varName2 -> resultVarName
SUB varName1 number -> resultVarName
MUL varName1 varName2 -> resultVarName
MUL varName1 number -> resultVarName
DIV varName1 varName2 -> resultVarName
DIV varName1 number -> resultVarName
MOD varName1 varName2 -> resultVarName
MOD varName1 number -> resultVarName

READ -> varName
PRINT '"stringContents"'
PRINT name

Все таблицы были сгенерированы с использованием [tablesgenerator](http://www.tablesgenerator.com/markdown_tables#).
