# Задание 3. Бинаризация документов
## Базовый алгоритм
### Описание
В качестве базового алгоритма была выбрана идея бинаризации Sauvola:
* изображение было разбито на непересекающиеся квадратные блоки размера (64, 64);
* порог вычисляется по формуле `mean * (1 + k * (std / R - 1))`, где `mean` и `std` -- это среднее и стандартное отклонение внутри блока, а `k` и `R` -- константы, значения которых брались из статьи: `k = 0.5`, `R = 128`.

### Выводы и наблюдения
* [ ] текст, цвет которого близок к фоновому, на многих участках изображений не извлекается;
* [ ] проявляются артефакты, связанные со стратегией разбиения изображения: видны куски черных квадратных областей;
* [ ] светлый текст на темном фоне извлекается плохо.

## Улучшение 1
Чтобы избавиться от артефактов при разбиении изображения на квадратные блоки и сделать выбор порога более гибким внутри блока, было решено изменить стратегию выбора порога:
* по изображению движется скользящее окно размера (65, 65);
* порог вычисляется по той же формуле, что и ранее;
* порог применяется только к центральному пикселю окна.

### Выводы и наблюдения
* [ ] текст, цвет которого близок к фоновому, на многих участках изображений не извлекается;
* [x] от квадратных черных артефактов удалось избавиться;
* [ ] светлый текст на темном фоне извлекается по-прежнему плохо.

## Улучшение 2
Чтобы улучшить извлечение текста, было решено уменьшить параметр `k` алгоритма, что ведет к увеличению порогов. В ходе нескольких экспериментов было выбрано значение `k = 0.2`, которое, кстати, задано значением по умолчанию для параметра `k` в функции `skimage.filters.threshold_sauvola` библиотеки scikit-image.

### Выводы и наблюдения
* [x] текст извлекается значительно лучше;
* [x] от квадратных черных артефактов удалось избавиться;
* [ ] появились шумовые черные точки на фоновых участках изображения;
* [ ] светлый текст на темном фоне извлекается по-прежнему плохо.

## Дальнейшие попытки улучшений
Были предприняты попытки по избавлению от шума, появившегося в улучшении 2, путем применения гауссова или медианного размытия к исходному изображению. В результата шумовых точек стало меньше, но извлеченный текст стал менее читаемым.  

Проблема с извлечением светлого текста на темном фоне была ожидаемой, т.к. алгоритм Sauvola изначально работает в предположении, что на изображении присутствует лишь темный текст на светлом фоне.

## Сравнение времени работы
|                  | Среднее время работы (в секундах) на одном изображении |
|------------------|--------------------------------------------------------|
| Базовый алгоритм | 28.92                                                  |
| Улучшение 1      | 237.92                                                 |
| Улучшение 2      | 234.91                                                 |

Значительное увеличение времени работы в улучшениях 1-2 по сравнению с базовым алгоритмом вызваны тем, что вместо перебора непересекающихся блоков фиксированного размера осуществляется перебор всех окон (почти) такого же размера.  
Для ускорения времени работы алгоритма был реализован предподсчет частичных сумм пикселей (интегральное изображение) и частичных сумм квадратов пикселей. За счет полученных матриц вычисление среднего и стандартного отклонения в окне выполняется за `O(1)`, а не за `O(w * w)`, где `w` -- размер (ширина или высота) окна.
